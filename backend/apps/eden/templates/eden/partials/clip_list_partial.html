<!-- templates/eden/partials/clip_list_partial.html -->
<div class="clip-strip-container">
  <button class="scroll-btn left" onclick="scrollClipList(-1)">◀</button>

  <div class="clip-list-row" id="clip-scroll-row">
    {% for clip in clips %}
      <div class="clip-card">
        <h3>{{ clip.title }}</h3>

        {% if clip.video_file %}
          <video class="clip-video" muted preload="metadata" playsinline>
            <source src="{{ clip.video_file.url }}" type="video/mp4">
            Your browser does not support the video tag.
          </video>
        {% else %}
          <p>No video uploaded yet.</p>
        {% endif %}

        <p>{{ clip.description|truncatewords:20 }}</p>

        {% if request.user.is_staff %}
          <form method="POST"
                hx-post="{% url 'delete_clip' clip.id %}"
                hx-get="/api/clips/html/"
                hx-target="#clip-strip-container"
                hx-swap="innerHTML"
                onsubmit="return confirm('Delete this clip?')">
            {% csrf_token %}
            <button type="submit">🗑️ Delete</button>
          </form>
        {% endif %}
      </div>
    {% empty %}
      <p>No clips uploaded yet.</p>
    {% endfor %}
  </div>

  <button class="scroll-btn right" onclick="scrollClipList(1)">▶</button>
</div>

<script>
  function scrollClipList(direction) {
    const container = document.getElementById('clip-scroll-row');
    container.scrollBy({
      left: direction * 300,
      behavior: 'smooth'
    });
  }

  const observer = new IntersectionObserver(entries => {
    entries.forEach(entry => {
      const video = entry.target;
      if (entry.isIntersecting) {
        video.play();
      } else {
        video.pause();
      }
    });
  }, { threshold: 0.6 });

  document.querySelectorAll('.clip-video').forEach(video => {
    observer.observe(video);
  });
</script>
